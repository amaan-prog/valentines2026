<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katelyn & Amaan's Love Story</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Georgia', serif;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .typing-indicator {
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }
        .heart-beat {
            animation: heartBeat 1.3s ease-in-out infinite;
        }
        @keyframes unlockFade {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .unlock-animation {
            animation: unlockFade 0.6s ease-out;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.5s;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAVikLXam-fzW8-UK3nNnnftuHkOzufeg4",
            authDomain: "valentines2026-8d3f3.firebaseapp.com",
            databaseURL: "https://valentines2026-8d3f3-default-rtdb.firebaseio.com",
            projectId: "valentines2026-8d3f3",
            storageBucket: "valentines2026-8d3f3.firebasestorage.app",
            messagingSenderId: "626066330237",
            appId: "1:626066330237:web:4faa77bcf11f621512d714",
            measurementId: "G-89MF737DKH"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const { useState, useEffect, createElement: h } = React;

        const PASSWORD = "<4";

        const CheckIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('polyline', { points: '20 6 9 17 4 12' })
        );

        const BookIcon = () => h('svg', { width: 24, height: 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('path', { d: 'M4 19.5A2.5 2.5 0 0 1 6.5 17H20' }),
            h('path', { d: 'M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z' })
        );

        const DownloadIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
            h('polyline', { points: '7 10 12 15 17 10' }),
            h('line', { x1: 12, y1: 15, x2: 12, y2: 3 })
        );

        const RefreshIcon = () => h('svg', { width: 20, height: 20, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('polyline', { points: '1 4 1 10 7 10' }),
            h('polyline', { points: '23 20 23 14 17 14' }),
            h('path', { d: 'M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15' })
        );

        const WifiIcon = () => h('svg', { width: 16, height: 16, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
            h('path', { d: 'M5 12.55a11 11 0 0 1 14.08 0' }),
            h('path', { d: 'M1.42 9a16 16 0 0 1 21.16 0' }),
            h('path', { d: 'M8.53 16.11a6 6 0 0 1 6.95 0' }),
            h('line', { x1: 12, y1: 20, x2: 12.01, y2: 20 })
        );

        const topics = [
            { title: "First Impressions", question: "What was your first thought when you met me?" },
            { title: "The Moment I Knew", question: "When did you realize you were falling in love with me?" },
            { title: "My Favorite Memory", question: "What is your favorite memory of us together?" },
            { title: "What Makes You Smile", question: "What is one thing I do that always makes you smile?" },
            { title: "Our Song", question: "If we had a theme song, what would it be and why?" },
            { title: "Dream Date", question: "Describe your perfect date with me." },
            { title: "Little Things", question: "What little thing do I do that means the world to you?" },
            { title: "Your Laugh", question: "What makes you laugh the hardest when we're together?" },
            { title: "Future Dreams", question: "What do you dream about for our future together?" },
            { title: "The Way You Love", question: "How do you feel most loved by me?" },
            { title: "Our Inside Jokes", question: "What's our funniest inside joke?" },
            { title: "When I'm Away", question: "What do you miss most about me when we're apart?" },
            { title: "Comfort Zone", question: "What makes you feel most comfortable and safe with me?" },
            { title: "Growing Together", question: "How have I helped you grow as a person?" },
            { title: "Unique Qualities", question: "What do you love most about my personality?" },
            { title: "Physical Attraction", question: "What physical feature of mine do you find most attractive?" },
            { title: "Acts of Love", question: "What's the most romantic thing I've ever done for you?" },
            { title: "Daily Rituals", question: "What's your favorite daily routine we share?" },
            { title: "Challenges Overcome", question: "What challenge have we overcome that made us stronger?" },
            { title: "Your Support", question: "How do I support you in pursuing your dreams?" },
            { title: "Pillow Talk", question: "What do you love most about our late-night conversations?" },
            { title: "Adventure Awaits", question: "Where in the world do you want to travel with me?" },
            { title: "Home Feeling", question: "What makes you feel at home when you're with me?" },
            { title: "Grateful Heart", question: "What are you most grateful for about our relationship?" },
            { title: "Your Quirks", question: "What quirky thing about me do you secretly love?" },
            { title: "Perfect Sunday", question: "Describe the perfect lazy Sunday together." },
            { title: "Words Unspoken", question: "What do you wish I knew without you having to say it?" },
            { title: "The Butterflies", question: "What do I do that still gives you butterflies?" },
            { title: "Teamwork", question: "What makes us such a great team?" },
            { title: "Your Pride", question: "What about me makes you feel proud?" },
            { title: "Surprise Moments", question: "What's the best surprise I've ever given you?" },
            { title: "The Little Look", question: "What does my smile mean to you?" },
            { title: "Trust & Honesty", question: "How have I shown you that you can trust me completely?" },
            { title: "Your Favorite Gift", question: "What's the most meaningful gift I've given you?" },
            { title: "Pet Names", question: "What's your favorite nickname I call you?" },
            { title: "Morning Moments", question: "What do you love about waking up next to me?" },
            { title: "Rainy Days", question: "What's your ideal rainy day activity with me?" },
            { title: "Your Champion", question: "How do I make you feel like you can conquer anything?" },
            { title: "Communication", question: "What do you appreciate most about how we communicate?" },
            { title: "Your Happy Place", question: "Where is your favorite place to be with me?" },
            { title: "Dancing in the Dark", question: "Describe a perfect moment of dancing together." },
            { title: "Your Best Friend", question: "How am I not just your lover but also your best friend?" },
            { title: "The Way You Touch", question: "What kind of physical affection do you love most from me?" },
            { title: "Silly Moments", question: "What's the silliest thing we've ever done together?" },
            { title: "Movie Night", question: "What's your favorite movie to watch cuddled up together?" },
            { title: "The Real Me", question: "What part of the 'real me' do you love most?" },
            { title: "Shared Goals", question: "What goal are you excited for us to achieve together?" },
            { title: "The First Kiss", question: "How did our first kiss make you feel?" },
            { title: "Holding Hands", question: "What does it feel like when we hold hands?" },
            { title: "The Love Letter", question: "Write me a love letter expressing your deepest feelings." }
        ];

        function ValentinesNotebook() {
            const [isUnlocked, setIsUnlocked] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [showError, setShowError] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('cover');
            const [currentTopic, setCurrentTopic] = useState(0);
            const [answers, setAnswers] = useState({});
            const [showSaveNotification, setShowSaveNotification] = useState(false);
            const [isConnected, setIsConnected] = useState(true);
            const [typingStatus, setTypingStatus] = useState({});
            const [revealedTopics, setRevealedTopics] = useState({});
            const [completedAnswers, setCompletedAnswers] = useState({});

            useEffect(() => {
                const unlocked = sessionStorage.getItem('unlocked');
                const user = sessionStorage.getItem('currentUser');
                if (unlocked === 'true') setIsUnlocked(true);
                if (user) setCurrentUser(user);
            }, []);

            useEffect(() => {
                if (!isUnlocked) return;
                const connectedRef = database.ref('.info/connected');
                connectedRef.on('value', (snap) => {
                    setIsConnected(snap.val() === true);
                });
                return () => connectedRef.off();
            }, [isUnlocked]);

            useEffect(() => {
                if (!isUnlocked) return;
                const answersRef = database.ref('answers');
                answersRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) setAnswers(data);
                });
                return () => answersRef.off();
            }, [isUnlocked]);

            useEffect(() => {
                if (!isUnlocked) return;
                const typingRef = database.ref('typing');
                typingRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) setTypingStatus(data);
                });
                return () => typingRef.off();
            }, [isUnlocked]);

            useEffect(() => {
                if (!isUnlocked) return;
                const revealedRef = database.ref('revealed');
                revealedRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) setRevealedTopics(data);
                });
                return () => revealedRef.off();
            }, [isUnlocked]);

            useEffect(() => {
                if (!isUnlocked) return;
                const completedRef = database.ref('completed');
                completedRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) setCompletedAnswers(data);
                });
                return () => completedRef.off();
            }, [isUnlocked]);

            const handlePasswordSubmit = (e) => {
                e.preventDefault();
                if (passwordInput.toLowerCase() === PASSWORD.toLowerCase()) {
                    setIsUnlocked(true);
                    sessionStorage.setItem('unlocked', 'true');
                } else {
                    setShowError(true);
                    setTimeout(() => setShowError(false), 500);
                }
            };

            const selectUser = (user) => {
                setCurrentUser(user);
                sessionStorage.setItem('currentUser', user);
            };

            const saveAnswer = (topicIndex, partner, value) => {
                database.ref(`answers/${topicIndex}/${partner}`).set(value);
                setTimeout(() => {
                    database.ref(`typing/${topicIndex}/${partner}`).set(false);
                }, 500);
            };

            const setTyping = (topicIndex, partner, isTyping) => {
                database.ref(`typing/${topicIndex}/${partner}`).set(isTyping);
            };

            const exportData = () => {
                const data = {
                    answers,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'katelyn-amaan-love-story.json';
                a.click();
                URL.revokeObjectURL(url);
                setShowSaveNotification(true);
                setTimeout(() => setShowSaveNotification(false), 3000);
            };

            const resetData = () => {
                if (confirm('Are you sure you want to delete all answers? This will affect both of you and cannot be undone.')) {
                    database.ref('answers').remove();
                    database.ref('typing').remove();
                    database.ref('revealed').remove();
                    database.ref('completed').remove();
                    setShowSaveNotification(true);
                    setTimeout(() => setShowSaveNotification(false), 3000);
                }
            };

            const toggleReveal = (topicIndex) => {
                const currentStatus = revealedTopics[topicIndex] || false;
                const newStatus = !currentStatus;
                console.log('Toggling reveal for topic', topicIndex, 'from', currentStatus, 'to', newStatus);
                database.ref(`revealed/${topicIndex}`).set(newStatus);
            };

            const markComplete = (topicIndex, partner) => {
                const currentStatus = completedAnswers[topicIndex]?.[partner] || false;
                database.ref(`completed/${topicIndex}/${partner}`).set(!currentStatus);
            };

            const isAnswerComplete = (topicIndex, partner) => {
                return completedAnswers[topicIndex]?.[partner] === true;
            };

            const canReveal = (topicIndex) => {
                const topicAnswers = answers[topicIndex];
                const hasKatelyn = topicAnswers?.katelyn?.trim();
                const hasAmaan = topicAnswers?.amaan?.trim();
                const katelynDone = isAnswerComplete(topicIndex, 'katelyn');
                const amaanDone = isAnswerComplete(topicIndex, 'amaan');
                const canRevealResult = hasKatelyn && hasAmaan && katelynDone && amaanDone;
                console.log('Can reveal topic', topicIndex, ':', canRevealResult, '(Katelyn done:', katelynDone, 'Amaan done:', amaanDone, ')');
                return canRevealResult;
            };

            const isRevealed = (topicIndex) => {
                return revealedTopics[topicIndex] === true;
            };

            const getProgress = () => {
                const total = topics.length * 2;
                let completed = 0;
                Object.values(answers).forEach(topic => {
                    if (topic.katelyn && topic.katelyn.trim()) completed++;
                    if (topic.amaan && topic.amaan.trim()) completed++;
                });
                return Math.round((completed / total) * 100);
            };

            const isTopicComplete = (index) => {
                return answers[index]?.katelyn?.trim() && answers[index]?.amaan?.trim();
            };

            if (!isUnlocked) {
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-pink-100 via-rose-100 to-pink-200 flex items-center justify-center p-8' },
                    h('div', { className: 'text-center max-w-md w-full' },
                        h('div', { className: 'mb-8 heart-beat' },
                            h('div', { className: 'text-8xl' }, 'ðŸ”’')
                        ),
                        h('h1', { className: 'text-4xl font-serif text-rose-600 mb-4' }, 'Katelyn & Amaan'),
                        h('p', { className: 'text-xl text-rose-500 italic mb-8' }, 'Our Love Story'),
                        h('form', { 
                            onSubmit: handlePasswordSubmit,
                            className: `bg-white rounded-2xl p-8 shadow-2xl ${showError ? 'shake' : ''}`
                        },
                            h('label', { className: 'block text-rose-600 font-semibold mb-3 text-lg' }, 'Enter Our Love Symbol To Unlock'),
                            h('input', {
                                type: 'password',
                                value: passwordInput,
                                onChange: (e) => setPasswordInput(e.target.value),
                                className: `w-full p-4 border-2 ${showError ? 'border-red-400' : 'border-rose-200'} rounded-lg focus:border-rose-400 focus:outline-none text-center text-lg`,
                                placeholder: 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢',
                                autoFocus: true
                            }),
                            showError && h('p', { className: 'text-red-500 text-sm mt-2' }, 'Incorrect password. Try again! ðŸ’•'),
                            h('button', {
                                type: 'submit',
                                className: 'w-full mt-6 bg-gradient-to-r from-rose-500 to-pink-500 text-white px-8 py-4 rounded-full text-lg font-semibold hover:shadow-2xl transform hover:scale-105 transition-all duration-300'
                            }, 'âœ¨ Unlock Our Story âœ¨')
                        ),
                        h('div', { className: 'mt-8 text-rose-300 text-sm float' }, 'â¤ï¸ ðŸ’• â¤ï¸')
                    )
                );
            }

            if (isUnlocked && !currentUser) {
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-pink-100 via-rose-100 to-pink-200 flex items-center justify-center p-8' },
                    h('div', { className: 'text-center max-w-2xl w-full unlock-animation' },
                        h('div', { className: 'text-6xl mb-6' }, 'â¤ï¸ ðŸ’• â¤ï¸'),
                        h('h1', { className: 'text-5xl font-serif text-rose-600 mb-4' }, 'Who are you?'),
                        h('p', { className: 'text-xl text-rose-500 mb-8' }, 'Select your name to continue'),
                        h('div', { className: 'flex gap-6 justify-center flex-wrap' },
                            h('button', {
                                onClick: () => selectUser('katelyn'),
                                className: 'bg-white hover:bg-gradient-to-br hover:from-pink-100 hover:to-rose-100 border-4 border-rose-300 text-rose-600 px-12 py-8 rounded-3xl text-2xl font-bold hover:shadow-2xl transform hover:scale-105 transition-all duration-300'
                            }, 
                                h('div', { className: 'text-4xl mb-2' }, 'ðŸ’–'),
                                h('div', null, 'Katelyn')
                            ),
                            h('button', {
                                onClick: () => selectUser('amaan'),
                                className: 'bg-white hover:bg-gradient-to-br hover:from-pink-100 hover:to-rose-100 border-4 border-rose-300 text-rose-600 px-12 py-8 rounded-3xl text-2xl font-bold hover:shadow-2xl transform hover:scale-105 transition-all duration-300'
                            },
                                h('div', { className: 'text-4xl mb-2' }, 'ðŸ’™'),
                                h('div', null, 'Amaan')
                            )
                        )
                    )
                );
            }

            if (currentPage === 'cover') {
                return h('div', { className: 'relative unlock-animation' },
                    showSaveNotification && h('div', { className: 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl z-50 flex items-center gap-2' },
                        h(CheckIcon),
                        'Saved!'
                    ),
                    h('div', { className: 'fixed top-4 left-4 z-50 flex gap-2' },
                        h('button', { 
                            onClick: exportData,
                            className: 'bg-white text-rose-600 p-3 rounded-full shadow-lg hover:shadow-xl transition-all border-2 border-rose-200',
                            title: 'Export Backup'
                        }, h(DownloadIcon)),
                        h('button', { 
                            onClick: resetData,
                            className: 'bg-white text-rose-600 p-3 rounded-full shadow-lg hover:shadow-xl transition-all border-2 border-rose-200',
                            title: 'Reset All Data'
                        }, h(RefreshIcon))
                    ),
                    h('div', { className: `fixed top-4 right-4 z-50 flex items-center gap-2 px-3 py-2 rounded-full ${isConnected ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}` },
                        h(WifiIcon),
                        h('span', { className: 'text-sm font-semibold' }, isConnected ? 'Connected' : 'Offline')
                    ),
                    h('div', { className: 'min-h-screen bg-gradient-to-br from-pink-100 via-pink-50 to-rose-100 flex items-center justify-center p-8' },
                        h('div', { className: 'text-center max-w-2xl' },
                            h('div', { className: 'text-6xl mb-6' }, 'â¤ï¸ ðŸ’• â¤ï¸'),
                            h('h1', { className: 'text-6xl font-serif text-rose-600 mb-4 drop-shadow-lg' }, 'Katelyn & Amaan'),
                            h('p', { className: 'text-3xl text-rose-500 italic mb-4' }, 'Our Love Story'),
                            h('p', { className: 'text-lg text-rose-400 mb-8' }, '50 Reasons Why We Love Each Other'),
                            h('p', { className: 'text-sm text-rose-400 mb-4' }, `Logged in as: ${currentUser === 'katelyn' ? 'ðŸ’– Katelyn' : 'ðŸ’™ Amaan'}`),
                            h('div', { className: 'text-5xl mb-8' }, 'ðŸ’– â¤ï¸ ðŸ’–'),
                            h('div', { className: 'bg-white rounded-2xl p-6 shadow-xl mb-8' },
                                h('div', { className: 'flex items-center justify-between mb-3' },
                                    h('span', { className: 'text-rose-600 font-semibold' }, 'Progress'),
                                    h('span', { className: 'text-rose-600 font-bold' }, getProgress() + '%')
                                ),
                                h('div', { className: 'w-full bg-rose-100 rounded-full h-4' },
                                    h('div', { 
                                        className: 'bg-gradient-to-r from-rose-400 to-pink-500 h-4 rounded-full transition-all duration-500',
                                        style: { width: getProgress() + '%' }
                                    })
                                )
                            ),
                            h('button', {
                                onClick: () => setCurrentPage('index'),
                                className: 'bg-gradient-to-r from-rose-500 to-pink-500 text-white px-12 py-4 rounded-full text-xl font-semibold hover:shadow-2xl transform hover:scale-105 transition-all duration-300 inline-flex items-center gap-2'
                            },
                                h(BookIcon),
                                'Start Our Journey'
                            )
                        )
                    )
                );
            }

            if (currentPage === 'index') {
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-pink-50 to-rose-50 p-8' },
                    h('div', { className: 'max-w-6xl mx-auto' },
                        h('div', { className: 'text-center mb-8' },
                            h('h2', { className: 'text-4xl font-serif text-rose-600 mb-4' }, 'Our 50 Questions'),
                            h('div', { className: 'text-rose-400' }, 'â¤ï¸ ðŸ’• â¤ï¸')
                        ),
                        h('div', { className: 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8' },
                            topics.map((topic, index) => 
                                h('button', {
                                    key: index,
                                    onClick: () => {
                                        setCurrentTopic(index);
                                        setCurrentPage('topic');
                                    },
                                    className: `p-4 rounded-xl font-semibold transition-all duration-300 hover:scale-105 hover:shadow-xl ${
                                        isTopicComplete(index)
                                            ? 'bg-gradient-to-br from-green-100 to-emerald-100 border-2 border-green-400 text-green-700'
                                            : 'bg-white border-2 border-rose-200 text-rose-600 hover:border-rose-400'
                                    }`
                                },
                                    h('div', { className: 'flex items-center justify-between mb-2' },
                                        h('span', { className: 'text-sm' }, '#' + (index + 1)),
                                        isTopicComplete(index) && h(CheckIcon, { size: 16, className: 'text-green-600' })
                                    ),
                                    h('div', { className: 'text-sm' }, topic.title)
                                )
                            )
                        ),
                        h('button', {
                            onClick: () => setCurrentPage('cover'),
                            className: 'bg-rose-500 text-white px-8 py-3 rounded-full font-semibold hover:bg-rose-600 transition-all'
                        }, 'Back to Cover')
                    )
                );
            }

            if (currentPage === 'topic') {
                const topic = topics[currentTopic];
                const katelynTyping = typingStatus[currentTopic]?.katelyn;
                const amaanTyping = typingStatus[currentTopic]?.amaan;
                const revealed = isRevealed(currentTopic);
                const bothAnswered = canReveal(currentTopic);
                const katelynComplete = isAnswerComplete(currentTopic, 'katelyn');
                const amaanComplete = isAnswerComplete(currentTopic, 'amaan');
                
                return h('div', { className: 'min-h-screen bg-gradient-to-br from-pink-50 to-rose-50 p-8' },
                    h('div', { className: 'max-w-4xl mx-auto' },
                        h('div', { className: 'bg-white rounded-2xl shadow-2xl p-8 lg:p-12' },
                            h('div', { className: 'flex justify-between items-center mb-6' },
                                h('span', { className: 'text-rose-500 font-bold' }, `Page ${currentTopic + 1} of 50`),
                                h('div', { className: 'flex items-center gap-2' },
                                    isTopicComplete(currentTopic) && h('span', { className: 'bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold flex items-center gap-1' },
                                        h(CheckIcon, { size: 16 }),
                                        ' Complete'
                                    )
                                )
                            ),
                            h('h2', { className: 'text-4xl font-serif text-rose-600 text-center mb-6 pb-4 border-b-4 border-rose-300' },
                                topic.title
                            ),
                            h('div', { className: 'text-center text-rose-400 text-2xl mb-6' }, 'â¤ï¸ ðŸ’• â¤ï¸'),
                            h('p', { className: 'text-xl text-gray-700 mb-8 text-center leading-relaxed' },
                                topic.question
                            ),
                            h('div', { className: 'mb-6 text-center' },
                                h('div', null,
                                    bothAnswered && !revealed && h('button', {
                                        onClick: (e) => {
                                            e.preventDefault();
                                            console.log('Reveal button clicked for topic', currentTopic);
                                            toggleReveal(currentTopic);
                                        },
                                        className: 'bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-full font-semibold hover:shadow-2xl transform hover:scale-105 transition-all duration-300 inline-flex items-center gap-2'
                                    }, 'ðŸŽ Reveal Answers'),
                                    bothAnswered && !revealed && h('p', { className: 'text-sm text-gray-500 mt-2' }, 'Both are done! Click to reveal.'),
                                    !bothAnswered && h('p', { className: 'text-sm text-gray-400' }, 'Both must mark as done before revealing (' + (katelynComplete ? 'âœ“' : 'âœ—') + ' Katelyn, ' + (amaanComplete ? 'âœ“' : 'âœ—') + ' Amaan)'),
                                    revealed && h('p', { className: 'text-sm text-green-600 font-semibold' }, 'âœ¨ Answers Revealed! âœ¨')
                                )
                            ),
                            h('div', { className: 'space-y-6' },
                                h('div', { className: 'border-t-2 border-dashed border-rose-200 pt-6' },
                                    h('div', { className: 'flex items-center justify-between mb-3' },
                                        h('label', { className: 'block text-rose-600 font-bold text-lg' }, 'Katelyn:'),
                                        katelynTyping && currentUser !== 'katelyn' && h('span', { className: 'text-sm text-rose-400 typing-indicator' }, 'âœï¸ typing...')
                                    ),
                                    revealed ? (
                                        h('div', { className: 'w-full min-h-[150px] p-4 border-2 border-green-200 bg-green-50 rounded-xl font-serif text-gray-700 whitespace-pre-wrap' },
                                            answers[currentTopic]?.katelyn || 'No answer yet'
                                        )
                                    ) : currentUser === 'katelyn' ? (
                                        h('div', null,
                                            h('textarea', {
                                                value: answers[currentTopic]?.katelyn || '',
                                                onChange: (e) => saveAnswer(currentTopic, 'katelyn', e.target.value),
                                                onFocus: () => setTyping(currentTopic, 'katelyn', true),
                                                onBlur: () => setTyping(currentTopic, 'katelyn', false),
                                                className: 'w-full min-h-[150px] p-4 border-2 border-rose-200 rounded-xl focus:border-rose-400 focus:outline-none resize-y font-serif text-gray-700',
                                                placeholder: 'Write your answer here...',
                                                disabled: katelynComplete
                                            }),
                                            answers[currentTopic]?.katelyn?.trim() && h('div', { className: 'mt-3 flex items-center gap-2' },
                                                katelynComplete ? (
                                                    h('button', {
                                                        onClick: () => markComplete(currentTopic, 'katelyn'),
                                                        className: 'bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition-all flex items-center gap-2'
                                                    }, 
                                                        h(CheckIcon, { size: 16 }),
                                                        'Done! (Click to edit)'
                                                    )
                                                ) : (
                                                    h('button', {
                                                        onClick: () => markComplete(currentTopic, 'katelyn'),
                                                        className: 'bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition-all'
                                                    }, 'âœ“ Mark as Done')
                                                )
                                            )
                                        )
                                    ) : (
                                        answers[currentTopic]?.katelyn?.trim() ? (
                                            h('div', { className: 'w-full min-h-[150px] p-4 border-2 border-purple-200 bg-purple-50 rounded-xl font-serif text-gray-400 flex items-center justify-center text-center' },
                                                h('div', null,
                                                    h('div', { className: 'text-4xl mb-2' }, katelynComplete ? 'âœ…' : 'âœï¸'),
                                                    h('div', { className: 'font-semibold' }, katelynComplete ? 'Katelyn is Done!' : 'Katelyn is Writing...'),
                                                    h('div', { className: 'text-sm mt-1' }, katelynComplete ? 'Waiting to reveal...' : 'Not marked as done yet')
                                                )
                                            )
                                        ) : (
                                            h('div', { className: 'w-full min-h-[150px] p-4 border-2 border-gray-200 bg-gray-50 rounded-xl font-serif text-gray-400 flex items-center justify-center text-center' },
                                                h('div', null,
                                                    h('div', { className: 'text-4xl mb-2' }, 'â³'),
                                                    h('div', { className: 'font-semibold' }, 'Waiting for Katelyn...'),
                                                    h('div', { className: 'text-sm mt-1' }, 'She hasn\'t answered yet')
                                                )
                                            )
                                        )
                                    )
                                ),
                                h('div', { className: 'border-t-2 border-dashed border-rose-200 pt-6' },
                                    h('div', { className: 'flex items-center justify-between mb-3' },
                                        h('label', { className: 'block text-rose-600 font-bold text-lg' }, 'Amaan:'),
                                        amaanTyping && currentUser !== 'amaan' && h('span', { className: 'text-sm text-rose-400 typing-indicator' }, 'âœï¸ typing...')
                                    ),
                                    revealed ? (
                                        h('div', { className: 'w-full min-h-[150px] p-4 border-2 border-green-200 bg-green-50 rounded-xl font-serif text-gray-700 whitespace-pre-wrap' },
                                            answers[currentTopic]?.amaan || 'No answer yet'
                                        )
                                    ) : currentUser === 'amaan' ? (
                                        h('div', null,
                                            h('textarea', {
                                                value: answers[currentTopic]?.amaan || '',
                                                onChange: (e) => saveAnswer(currentTopic, 'amaan', e.target.value),
                                                onFocus: () => setTyping(currentTopic, 'amaan', true),
                                                onBlur: () => setTyping(currentTopic, 'amaan', false),
                                                className: 'w-full min-h-[150px] p-4 border-2 border-rose-200 rounded-xl focus:border-rose-400 focus:outline-none resize-y font-serif text-gray-700',
                                                placeholder: 'Write your answer here...',
                                                disabled: amaanComplete
                                            }),
                                            answers[currentTopic]?.amaan?.trim() && h('div', { className: 'mt-3 flex items-center gap-2' },
                                                amaanComplete ? (
                                                    h('button', {
                                                        onClick: () => markComplete(currentTopic, 'amaan'),
                                                        className: 'bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition-all flex items-center gap-2'
                                                    }, 
                                                        h(CheckIcon, { size: 16 }),
                                                        'Done! (Click to edit)'
                                                    )
                                                ) : (
                                                    h('button', {
                                                        onClick: () => markComplete(currentTopic, 'amaan'),
                                                        className: 'bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition-all'
                                                    }, 'âœ“ Mark as Done')
                                                )
                                            )
                                        )
                                    ) : (
                                        answers[currentTopic]?.amaan?.trim() ? (
                                            h('div', { className: 'w-full min-h-[150px] p-4 border-2 border-purple-200 bg-purple-50 rounded-xl font-serif text-gray-400 flex items-center justify-center text-center' },
                                                h('div', null,
                                                    h('div', { className: 'text-4xl mb-2' }, amaanComplete ? 'âœ…' : 'âœï¸'),
                                                    h('div', { className: 'font-semibold' }, amaanComplete ? 'Amaan is Done!' : 'Amaan is Writing...'),
                                                    h('div', { className: 'text-sm mt-1' }, amaanComplete ? 'Waiting to reveal...' : 'Not marked as done yet')
                                                )
                                            )
                                        ) : (
                                            h('div', { className: 'w-full min-h-[150px] p-4 border-2 border-gray-200 bg-gray-50 rounded-xl font-serif text-gray-400 flex items-center justify-center text-center' },
                                                h('div', null,
                                                    h('div', { className: 'text-4xl mb-2' }, 'â³'),
                                                    h('div', { className: 'font-semibold' }, 'Waiting for Amaan...'),
                                                    h('div', { className: 'text-sm mt-1' }, 'He hasn\'t answered yet')
                                                )
                                            )
                                        )
                                    )
                                )
                            ),
                            revealed && h('div', { className: 'mt-6 text-center' },
                                h('button', {
                                    onClick: () => toggleReveal(currentTopic),
                                    className: 'bg-gray-500 text-white px-6 py-2 rounded-full font-semibold hover:bg-gray-600 transition-all text-sm'
                                }, 'ðŸ”’ Hide Answers')
                            ),
                            h('div', { className: 'flex flex-wrap gap-4 mt-8 justify-between' },
                                h('button', {
                                    onClick: () => setCurrentTopic(Math.max(0, currentTopic - 1)),
                                    disabled: currentTopic === 0,
                                    className: 'bg-rose-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-rose-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all'
                                }, 'â† Previous'),
                                h('button', {
                                    onClick: () => setCurrentPage('index'),
                                    className: 'bg-white border-2 border-rose-500 text-rose-500 px-6 py-3 rounded-full font-semibold hover:bg-rose-50 transition-all'
                                }, 'View Index'),
                                h('button', {
                                    onClick: () => setCurrentTopic(Math.min(topics.length - 1, currentTopic + 1)),
                                    disabled: currentTopic === topics.length - 1,
                                    className: 'bg-rose-500 text-white px-6 py-3 rounded-full font-semibold hover:bg-rose-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all'
                                }, 'Next â†’')
                            )
                        )
                    )
                );
            }
        }

        ReactDOM.render(h(ValentinesNotebook), document.getElementById('root'));
    </script>
</body>
</html>
